<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <meta name="cfg" content='{"apiKey":"AIzaSyC9fbqoFn2aX145bLIsAGPmKnKqaVXszto","authDomain":"poker-stats-prod.firebaseapp.com","projectId":"poker-stats-prod","storageBucket":"poker-stats-prod.firebasestorage.app","messagingSenderId":"366474801487","appId":"1:366474801487:web:f1611e8a49db791b67953a"}'>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 40px; }
    #googleBtn {
      background: #db4437;
      color: white;
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 12px;
    }
    #msg {
      color: #d33;
      font-size: 0.9em;
      height: 1.2em;
      margin-top: 12px;
    }
  </style>
</head>
<body>
  <h2>スタッツ解析アプリ</h2>
  <p><strong>ログイン</strong></p>

  <!-- Googleログイン -->
  <button onclick="googleLogin()" id="googleBtn">Googleでログイン</button>

  <div id="recaptcha-container" style="display:none"></div>
  <p id="msg"></p>

  <script>
    let auth;
    try {
      const cfg = JSON.parse(document.querySelector("meta[name=cfg]").content);
      firebase.initializeApp(cfg);
      auth = firebase.auth();
    } catch (e) {
      document.getElementById("msg").textContent = "⚠ Firebase 初期化失敗";
      console.error(e);
    }

    const googleProvider = new firebase.auth.GoogleAuthProvider();

    function googleLogin() {
      auth.signInWithPopup(googleProvider)
        .then(r => r.user.getIdToken())
        .then(tok => {
          const url = "https://pokerapp-l57n.onrender.com/?token=" + encodeURIComponent(tok);
          window.location.href = url;
        })
        .catch(e => msg.textContent = e.message);
    }
  </script>
</body>
</html>
