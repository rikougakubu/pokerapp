<!DOCTYPE html>
<html>
<head>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <meta name="cfg" content=''>
  <style>body{font-family:sans-serif;text-align:center;}input,button{margin:4px;padding:6px;}</style>
</head>
<body>
  <input id="email" placeholder="email">
  <input id="pw" type="password" placeholder="pw">
  <button onclick="pw()">PWÂ login</button>
  <button onclick="anon()">Anon</button>
  <p id="msg"></p>
<script>
const cfg = JSON.parse(document.querySelector('meta[name=cfg]').content);
firebase.initializeApp(cfg);
const auth = firebase.auth();

function pw(){
  auth.signInWithEmailAndPassword(email.value,pw.value)
      .catch(e=>{ if(e.code==="auth/user-not-found")
          return auth.createUserWithEmailAndPassword(email.value,pw.value); throw e; })
      .then(u=>u.user.getIdToken())
      .then(t=>window.parent.postMessage({token:t},"*"))
      .catch(e=>msg.textContent=e.message);
}
function anon(){
  auth.signInAnonymously()
      .then(u=>u.user.getIdToken())
      .then(t=>window.parent.postMessage({token:t},"*"))
      .catch(e=>msg.textContent=e.message);
}
</script></body></html>
